# 直方图 (Histogram)

## 📊 图表简介

直方图是用**矩形的高度（或面积）**表示数据在各个区间内的频率或频数的图表，是了解单一变量数据分布的最基础工具。

## 🎯 适用场景

| 场景 | 说明 |
|------|------|
| **分布探索** | 快速了解数据的分布形态 |
| **异常检测** | 发现异常值或离群点 |
| **数据验证** | 检验数据是否符合某种分布（如正态分布） |
| **分组比较** | 比较两组数据的分布差异 |
| **数据预处理** | 了解数据特征，指导后续分析 |

## 📈 图表分类

### 1. 基础直方图
- 展示单一变量的频率分布
- 最常用的形式

### 2. 堆叠直方图
- 多组数据堆叠展示
- 展示总量和各部分构成

### 3. 并列直方图
- 多组数据并排展示
- 便于对比不同组的分布

### 4. 密度直方图
- Y轴为密度而非频数
- 便于与概率分布函数对比

### 5. 累积直方图
- 展示累积频率/频数
- 用于分析分位数

## ⚖️ 与相似图表的对比

| 对比图表 | 直方图优势 | 直方图劣势 |
|----------|-----------|-----------|
| **密度图** | 显示原始分箱信息 | 受分箱宽度影响大 |
| **箱线图** | 展示完整分布形态 | 不显示统计摘要 |
| **柱状图** | 适合连续数据 | 不适合分类数据 |
| **散点图** | 展示单变量分布 | 不展示两变量关系 |

## 🔄 直方图 vs 柱状图

### 关键区别

| 特征 | 直方图 | 柱状图 |
|------|--------|--------|
| **数据类型** | 连续数据 | 分类数据 |
| **柱子间隙** | 无间隙（连续）| 有间隙（离散）|
| **X轴** | 数值区间 | 类别标签 |
| **含义** | 频率分布 | 数值比较 |

## 🤔 如何选择

```
数据类型？
├── 连续数据 → 直方图
└── 分类数据 → 柱状图

展示目的？
├── 了解分布形态 → 直方图
├── 展示统计摘要 → 箱线图
├── 多组分布对比 → 小提琴图或密度图
└── 精确分布拟合 → 密度直方图 + 理论分布曲线

对比方式？
├── 2组 → 并列直方图或重叠直方图
├── 多组 → 分面直方图或山脊图
└── 按类别细分 → 堆叠直方图
```

## 💡 使用建议

1. **分箱数量**：
   - 过少：丢失分布细节
   - 过多：噪声过大
   - 经验公式：$\sqrt{n}$ 或 Sturges' 公式
2. **分箱宽度**：保持一致，便于比较
3. **起始位置**：可能影响直方图形态
4. **叠加密度曲线**：帮助理解整体分布趋势
5. **标注统计量**：添加均值、中位数等参考线
6. **颜色选择**：单组用单色，多组用对比色
7. **透明度设置**：多组重叠时使用透明度

## 📐 分布形态解读

| 形态 | 描述 | 可能原因 |
|------|------|----------|
| 对称单峰 | 正态分布型 | 自然测量数据 |
| 右偏 | 长尾在右 | 收入、等待时间 |
| 左偏 | 长尾在左 | 寿命、考试分数 |
| 双峰 | 两个峰值 | 混合两个群体 |
| 均匀 | 各区间频率相近 | 随机数、均匀分布 |
| 截断 | 某侧突然截止 | 数据被截断或过滤 |

## 📊 分箱数量选择公式

| 方法 | 公式 | 适用场景 |
|------|------|----------|
| Sturges | $k = 1 + \log_2(n)$ | 近似正态分布 |
| Square root | $k = \sqrt{n}$ | 通用 |
| Rice | $k = 2n^{1/3}$ | 大样本 |
| Freedman-Diaconis | $h = 2 \times IQR \times n^{-1/3}$ | 基于四分位距 |

## ⚠️ 常见陷阱

1. **分箱边界效应**：边界值的归属可能影响结果
2. **误解为柱状图**：直方图是连续的，柱状图是离散的
3. **忽略样本量**：小样本直方图可能不可靠
4. **比较不同n的直方图**：应使用密度而非频数
